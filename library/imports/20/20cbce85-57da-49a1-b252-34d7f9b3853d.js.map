{"version":3,"sources":["../../../../assets/Script/assets/Script/Game.ts"],"names":[],"mappings":";;;;;AAAM,IAAA,kBAAqC,EAAnC,oBAAO,EAAE,sBAAQ,CAAmB;AAC5C,uCAAqC;AACrC,uCAAyF;AAQzF;IAAsC,4BAAY;IADlD;QAAA,qEAiLC;QA7KC,gBAAU,GAAc,IAAI,CAAC;QAG7B,kBAAY,GAAc,IAAI,CAAC;QAG/B,SAAG,GAAY,IAAI,CAAA;QAGnB,YAAM,GAAY,IAAI,CAAA;QAGtB,WAAK,GAAe,EAAE,CAAA;QACtB,cAAQ,GAAW,CAAC,CAAA;QACpB,UAAI,GAAW,CAAC,CAAA;QAChB,qBAAe,GAAY,KAAK,CAAA;QAChC,aAAO,GAAW,CAAC,CAAA;;IA6JrB,CAAC;IA5JC,wBAAwB;IAExB,yBAAM,GAAN;QACE,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,MAAM,GAAG,CAAC,CAAC;QAC7C,IAAI,CAAC,GAAG,CAAC,YAAY,CAAC,KAAK,CAAC,CAAC,IAAI,GAAG,IAAI,CAAA;QACxC,IAAI,CAAC,YAAY,EAAE,CAAA;QACnB,IAAI,CAAC,aAAa,EAAE,CAAA;IACtB,CAAC;IAED,wBAAK,GAAL;IAEA,CAAC;IAED,+BAAY,GAAZ;QACE,IAAI,CAAC,WAAW,EAAE,CAAA;IACpB,CAAC;IAED,8BAAW,GAAX;QACE,IAAI,SAAS,GAAG,IAAI,CAAC,KAAK,CAAC,MAAM,CAAA;QACjC,IAAM,IAAI,GAAG,EAAE,CAAC,WAAW,CAAC,IAAI,CAAC,UAAU,CAAC,CAAA;QAC5C,WAAW;QACX,IAAI,MAAM,GAAG,SAAS,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,SAAS,GAAG,CAAC,CAAC,CAAC,EAAE,CAAA;QAC9D,WAAW;QACX,IAAI,KAAK,GAAG,WAAI,CAAC,MAAM,CAAC,KAAK,GAAG,WAAI,CAAC,MAAM,CAAC,KAAK,GAAG,CAAC,CAAC,GAAG,GAAG,CAAC,CAAA;QAC7D,eAAe;QACf,IAAI,KAAK,GAAG,EAAE,GAAG,IAAI,CAAC,QAAQ,GAAG,GAAG,GAAG,IAAI,GAAG,KAAK,CAAA;QACnD,kBAAkB;QAClB,IAAI,EAAE,GAAG,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,UAAU,EAAE,GAAG,CAAC,KAAK,GAAG,MAAM,CAAC,GAAG,MAAM,CAAC,CAAA;QAChE,OAAO;QACP,IAAI,OAAO,GAAG,EAAE,CAAC,UAAU,EAAE,GAAG,GAAG,CAAC,CAAC,CAAC,oBAAa,CAAC,IAAI,CAAC,CAAC,CAAC,oBAAa,CAAC,KAAK,CAAA;QAC9E,UAAU;QACV,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC;YACd,EAAE,EAAE,EAAE;YACN,SAAS,EAAE,OAAO;SACnB,CAAC,CAAA;QACF,kBAAkB;QAClB,IAAI,KAAK,CAAA;QACT,IAAI,WAAW,GAAG,EAAE,CAAC,UAAU,EAAE,CAAA;QACjC,IAAI,CAAS,EAAE,CAAS,CAAA;QACxB,IAAI,WAAW,GAAG,QAAQ,EAAE;YAC1B,KAAK,GAAG,gBAAS,CAAC,MAAM,CAAA;YACxB,CAAC,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,GAAG,CAAC,GAAG,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,GAAG,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC,MAAM,GAAG,KAAK,GAAG,CAAC,CAAA;SACjF;QACD,IAAI,WAAW,IAAI,QAAQ,IAAI,WAAW,IAAI,QAAQ,EAAE;YACtD,KAAK,GAAG,gBAAS,CAAC,GAAG,CAAA;YACrB,CAAC,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,GAAG,CAAC,GAAG,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,GAAG,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC,MAAM,GAAG,KAAK,GAAG,CAAC,CAAA;SACrF;QACD,IAAI,WAAW,GAAG,QAAQ,EAAE;YAC1B,KAAK,GAAG,gBAAS,CAAC,MAAM,CAAA;YACxB,CAAC,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,GAAG,CAAC,GAAG,IAAI,CAAC,IAAI,CAAC,GAAG,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC,MAAM,GAAG,KAAK,GAAG,CAAC,CAAA;SAC7E;QACD,CAAC,GAAG,OAAO,IAAI,oBAAa,CAAC,IAAI,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,KAAK,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,KAAK,GAAG,CAAC,CAAA;QAC9E,IAAI,IAAI,GAAG,IAAI,CAAC,YAAY,CAAC,MAAM,CAAC,CAAA;QACpC,IAAI,CAAC,GAAG,GAAG,IAAI,CAAC,EAAE,GAAG,EAAE,CAAA;QACvB,IAAI,CAAC,KAAK,GAAG,KAAK,CAAA;QAClB,IAAI,CAAC,IAAI,GAAG,CAAC,CAAA;QACb,IAAI,CAAC,IAAI,GAAG,IAAI,CAAA;QAChB,IAAI,CAAC,SAAS,GAAG,OAAO,CAAA;QACxB,IAAI,CAAC,EAAE,GAAG,IAAI,CAAC,OAAO,CAAA;QACtB,oBAAa,CAAC,IAAI,CAAC,OAAO,CAAC,GAAG;YAC5B,CAAC,EAAE,CAAC;YACJ,CAAC,EAAE,CAAC;YACJ,KAAK,EAAE,CAAC;YACR,IAAI,EAAE,IAAI;SACX,CAAA;QACD,IAAI,CAAC,OAAO,EAAE,CAAA;QACd,IAAI,CAAC,WAAW,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAA;QAC5B,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAA;IAC1B,CAAC;IAED,4BAAS,GAAT,UAAU,UAAU;QAClB,IAAI,UAAU,CAAC,KAAK,KAAK,gBAAS,CAAC,MAAM,EAAE;YACzC,OAAO;SACR;QACD,IAAI,KAAK,GAAG,UAAU,CAAC,KAAK,KAAK,gBAAS,CAAC,GAAG,CAAC,CAAC,CAAC,gBAAS,CAAC,MAAM,CAAC,CAAC,CAAC,gBAAS,CAAC,GAAG,CAAA;QACjF,IAAI,CAAC,aAAa,CAAC;YACjB,EAAE,EAAE,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,EAAE,GAAG,IAAI,CAAC;YACnC,SAAS,EAAE,oBAAa,CAAC,IAAI;YAC7B,CAAC,EAAE,UAAU,CAAC,IAAI,CAAC,CAAC;YACpB,CAAC,EAAE,UAAU,CAAC,IAAI,CAAC,CAAC;YACpB,KAAK,EAAE,KAAK;SACb,CAAC,CAAA;QACF,IAAI,CAAC,aAAa,CAAC;YACjB,EAAE,EAAE,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,EAAE,GAAG,IAAI,CAAC;YACnC,SAAS,EAAE,oBAAa,CAAC,KAAK;YAC9B,CAAC,EAAE,UAAU,CAAC,IAAI,CAAC,CAAC;YACpB,CAAC,EAAE,UAAU,CAAC,IAAI,CAAC,CAAC;YACpB,KAAK,EAAE,KAAK;SACb,CAAC,CAAA;IACJ,CAAC;IAED,gCAAa,GAAb,UAAc,EAA8B;YAA5B,UAAE,EAAE,wBAAS,EAAE,QAAC,EAAE,gBAAK,EAAE,QAAC;QACxC,IAAI,IAAI,CAAA;QACR,IAAM,IAAI,GAAG,EAAE,CAAC,WAAW,CAAC,IAAI,CAAC,UAAU,CAAC,CAAA;QAC5C,IAAI,KAAK,IAAI,gBAAS,CAAC,MAAM,EAAE;YAC7B,IAAI,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,GAAG,CAAC,GAAG,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,GAAG,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC,MAAM,GAAG,KAAK,GAAG,CAAC,CAAA;SACpF;aAAM;YACL,IAAI,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,GAAG,CAAC,GAAG,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,GAAG,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC,MAAM,GAAG,KAAK,GAAG,CAAC,CAAA;SACxF;QACD,IAAM,IAAI,GAAG,IAAI,CAAC,YAAY,CAAC,MAAM,CAAC,CAAA;QACtC,IAAI,CAAC,GAAG,GAAG,IAAI,CAAC,EAAE,GAAG,EAAE,CAAA;QACvB,IAAI,CAAC,KAAK,GAAG,KAAK,CAAA;QAClB,IAAI,CAAC,IAAI,GAAG,IAAI,CAAA;QAChB,IAAI,CAAC,IAAI,GAAG,IAAI,CAAA;QAChB,IAAI,CAAC,SAAS,GAAG,SAAS,CAAA;QAC1B,IAAI,CAAC,EAAE,GAAG,IAAI,CAAC,OAAO,CAAA;QACtB,oBAAa,CAAC,IAAI,CAAC,OAAO,CAAC,GAAG;YAC5B,CAAC,EAAE,CAAC;YACJ,CAAC,EAAE,CAAC;YACJ,KAAK,EAAE,CAAC;YACR,IAAI,EAAE,IAAI;SACX,CAAA;QACD,IAAI,CAAC,OAAO,EAAE,CAAA;QACd,IAAI,CAAC,WAAW,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAA;QAC5B,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAA;IAC1B,CAAC;IAED,gCAAa,GAAb;QACE,IAAM,MAAM,GAAG,EAAE,CAAC,WAAW,CAAC,IAAI,CAAC,YAAY,CAAC,CAAA;QAChD,IAAM,MAAM,GAAG,MAAM,CAAC,YAAY,CAAC,QAAQ,CAAC,CAAA;QAC5C,MAAM,CAAC,IAAI,GAAG,IAAI,CAAA;QAClB,MAAM,CAAC,EAAE,GAAG,IAAI,CAAC,OAAO,CAAA;QACxB,sBAAe,CAAC,IAAI,CAAC,OAAO,CAAC,GAAG;YAC9B,CAAC,EAAE,CAAC;YACJ,CAAC,EAAE,CAAC;YACJ,IAAI,EAAE,IAAI;YACV,IAAI,EAAE,KAAK;SACZ,CAAA;QACD,IAAI,CAAC,OAAO,EAAE,CAAA;QACd,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAA;IAC5B,CAAC;IAED,YAAY;IACZ,0BAAO,GAAP;QACE,KAAK,IAAM,CAAC,IAAI,sBAAe,EAAE;YAC/B,IAAM,MAAM,GAAG,sBAAe,CAAC,CAAC,CAAC,CAAA;YACjC,IAAI,CAAC,MAAM,CAAC,IAAI,EAAE;gBAChB,IAAM,OAAO,GAAG,EAAE,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,EAAE,MAAM,CAAC,CAAC,CAAC,CAAA;gBACxC,KAAK,IAAM,CAAC,IAAI,oBAAa,EAAE;oBAC7B,IAAM,IAAI,GAAG,oBAAa,CAAC,CAAC,CAAC,CAAA;oBAC7B,IAAM,KAAK,GAAG,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,EAAE,IAAI,CAAC,CAAC,CAAC,CAAA;oBAClC,IAAM,IAAI,GAAG,EAAE,CAAC,SAAS,CAAC,OAAO,EAAE,KAAK,CAAC,CAAA;oBACzC,IAAI,IAAI,GAAG,IAAI,CAAC,KAAK,GAAG,CAAC,EAAE;wBACzB,IAAI,CAAC,IAAI,CAAC,SAAS,EAAE,CAAA;wBACrB,MAAM,CAAC,IAAI,CAAC,SAAS,EAAE,CAAA;wBACvB,MAAM,CAAC,IAAI,GAAG,IAAI,CAAA;qBACnB;iBACF;aACF;SACF;IACH,CAAC;IAED,yBAAM,GAAN,UAAO,EAAE;QACP,IAAI,CAAC,QAAQ,IAAI,EAAE,CAAA;QACnB,IAAI,CAAC,OAAO,EAAE,CAAA;IAChB,CAAC;IA5KD;QADC,QAAQ,CAAC,EAAE,CAAC,MAAM,CAAC;gDACS;IAG7B;QADC,QAAQ,CAAC,EAAE,CAAC,MAAM,CAAC;kDACW;IAG/B;QADC,QAAQ,CAAC,EAAE,CAAC,IAAI,CAAC;yCACC;IAGnB;QADC,QAAQ,CAAC,EAAE,CAAC,IAAI,CAAC;4CACI;IAGtB;QADC,QAAQ;2CACa;IAfH,QAAQ;QAD5B,OAAO;OACa,QAAQ,CAgL5B;IAAD,eAAC;CAhLD,AAgLC,CAhLqC,EAAE,CAAC,SAAS,GAgLjD;kBAhLoB,QAAQ","file":"","sourceRoot":"../../../../assets/Script","sourcesContent":["const { ccclass, property } = cc._decorator;\nimport { user } from './modules/data'\nimport { ballScale, ballDerection, ballPositions, bulletPositions } from \"./modules/data\"\n\ninterface ballInfo {\n  HP: number,\n  derection: number\n}\n\n@ccclass\nexport default class NewClass extends cc.Component {\n\n  @property(cc.Prefab)\n  ballPrefab: cc.Prefab = null;\n\n  @property(cc.Prefab)\n  bulletPrefab: cc.Prefab = null;\n\n  @property(cc.Node)\n  car: cc.Node = null\n\n  @property(cc.Node)\n  ground: cc.Node = null\n\n  @property\n  balls: ballInfo[] = []\n  gameTime: number = 0\n  carY: number = 0\n  stopSpawnBullet: boolean = false\n  idCount: number = 0\n  // LIFE-CYCLE CALLBACKS:\n\n  onLoad() {\n    this.carY = this.car.y + this.car.height / 2;\n    this.car.getComponent('Car').game = this\n    this.spawnNewBall()\n    this.initNewBullet()\n  }\n\n  start() {\n\n  }\n\n  spawnNewBall() {\n    this.initNewBall()\n  }\n\n  initNewBall() {\n    let ballCount = this.balls.length\n    const ball = cc.instantiate(this.ballPrefab)\n    // 获取前二次的hp\n    let lastHP = ballCount <= 2 ? 0 : this.balls[ballCount - 3].HP\n    // 计算本次最大hp\n    let HPMax = user.bullet.power * user.bullet.speed * (1 + 0.5)\n    // 根据时间增长得出一个hp\n    let HPCur = 10 + this.gameTime / 120 * 1000 * HPMax\n    // 最终hp在前二次于本次之间选择\n    let HP = Math.floor(cc.random0To1() * (HPCur - lastHP) + lastHP)\n    // 随机方向\n    let dRandom = cc.random0To1() > 0.5 ? ballDerection.Left : ballDerection.Right\n    // 记录本次球信息\n    this.balls.push({\n      HP: HP,\n      derection: dRandom\n    })\n    // 随机ball的体积 并计算高度\n    let scale\n    let scaleRandom = cc.random0To1()\n    let x: number, y: number\n    if (scaleRandom < 0.333333) {\n      scale = ballScale.NORMAL\n      y = (this.node.height / 2 - this.carY) / 3 + this.carY - ball.height * scale / 2\n    }\n    if (scaleRandom >= 0.333333 && scaleRandom <= 0.666666) {\n      scale = ballScale.BIG\n      y = (this.node.height / 2 - this.carY) / 3 * 2 + this.carY - ball.height * scale / 2\n    }\n    if (scaleRandom > 0.666666) {\n      scale = ballScale.BIGBIG\n      y = (this.node.height / 2 - this.carY) + this.carY - ball.height * scale / 2\n    }\n    x = dRandom == ballDerection.Left ? this.node.width / 2 : -this.node.width / 2\n    let Ball = ball.getComponent('Ball')\n    Ball.num = Ball.HP = 50\n    Ball.scale = scale\n    Ball.maxY = y\n    Ball.game = this\n    Ball.derection = dRandom\n    Ball.id = this.idCount\n    ballPositions[this.idCount] = {\n      x: 0,\n      y: 0,\n      width: 0,\n      node: null\n    }\n    this.idCount++\n    ball.setPosition(cc.p(x, y))\n    this.node.addChild(ball)\n  }\n\n  splitBall(parentBall) {\n    if (parentBall.scale === ballScale.NORMAL) {\n      return;\n    }\n    let scale = parentBall.scale === ballScale.BIG ? ballScale.NORMAL : ballScale.BIG\n    this.initSplitBall({\n      HP: Math.ceil(parentBall.HP * 0.35),\n      derection: ballDerection.Left,\n      x: parentBall.node.x,\n      y: parentBall.node.y,\n      scale: scale\n    })\n    this.initSplitBall({\n      HP: Math.ceil(parentBall.HP * 0.65),\n      derection: ballDerection.Right,\n      x: parentBall.node.x,\n      y: parentBall.node.y,\n      scale: scale\n    })\n  }\n\n  initSplitBall({ HP, derection, x, scale, y }) {\n    let maxY\n    const ball = cc.instantiate(this.ballPrefab)\n    if (scale == ballScale.NORMAL) {\n      maxY = (this.node.height / 2 - this.carY) / 3 + this.carY - ball.height * scale / 2\n    } else {\n      maxY = (this.node.height / 2 - this.carY) / 3 * 2 + this.carY - ball.height * scale / 2\n    }\n    const Ball = ball.getComponent('Ball')\n    Ball.num = Ball.HP = HP\n    Ball.scale = scale\n    Ball.maxY = maxY\n    Ball.game = this\n    Ball.derection = derection\n    Ball.id = this.idCount\n    ballPositions[this.idCount] = {\n      x: 0,\n      y: 0,\n      width: 0,\n      node: null\n    }\n    this.idCount++\n    ball.setPosition(cc.p(x, y))\n    this.node.addChild(ball)\n  }\n\n  initNewBullet() {\n    const bullet = cc.instantiate(this.bulletPrefab)\n    const Bullet = bullet.getComponent('Bullet')\n    Bullet.game = this\n    Bullet.id = this.idCount\n    bulletPositions[this.idCount] = {\n      x: 0,\n      y: 0,\n      node: null,\n      fade: false\n    }\n    this.idCount++\n    this.node.addChild(bullet)\n  }\n\n  // 检测子弹与球体碰撞\n  onShoot() {\n    for (const i in bulletPositions) {\n      const bullet = bulletPositions[i]\n      if (!bullet.fade) {\n        const bulletP = cc.p(bullet.x, bullet.y)\n        for (const j in ballPositions) {\n          const ball = ballPositions[j]\n          const ballP = cc.p(ball.x, ball.y)\n          const dist = cc.pDistance(bulletP, ballP)\n          if (dist < ball.width / 2) {\n            ball.node.onShooted()\n            bullet.node.onShooted()\n            bullet.fade = true\n          }\n        }\n      }\n    }\n  }\n\n  update(dt) {\n    this.gameTime += dt\n    this.onShoot()\n  }\n}\n"]}